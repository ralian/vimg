ARG COMPILER=gcc:15
FROM $COMPILER AS builder

ADD https://gcc.gnu.org/git/gcc.git#trunk gcc

WORKDIR /gcc
RUN git submodule update --init --recursive; mkdir /build
RUN apt update && apt install -y libgmp-dev libmpfr-dev libmpc-dev flex
WORKDIR /build
RUN ../gcc/configure --enable-languages=c,c++ --disable-multilib --prefix=/gcc-16/

ARG JOBS=4
RUN make -j ${JOBS}
RUN make install

FROM ubuntu:latest

COPY --from=builder /gcc-16 /gcc-16
RUN apt update && apt install -y git cmake ninja-build
